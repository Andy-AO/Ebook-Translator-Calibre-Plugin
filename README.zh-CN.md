# 电子书翻译器（Calibre 插件）

一个可以将电子书翻译成指定语言（原文译文对照）的插件。

---

## 主要功能

* 支持所选翻译引擎所支持的语言（如 Google 翻译支持 134 种）
* 支持多种翻译引擎，包括 Google 翻译、ChatGPT 以及 DeepL
* 支持所有 Calibre 所支持的电子书格式（输入格式 48 种，输出格式 20 种）
* 支持批量翻译电子书，每本书的翻译过程同时进行互不影响
* 支持缓存翻译内容，在请求失败或网络中断后无需重新翻译
* 提供大量自定义设置，如将翻译的电子书存到 Calibre 书库或指定位置

---

## 设置说明

你可以通过“内容”和“设置”选项定制插件功能。

### 内容

__【 译文位置 】__

* __加在原文后__ [默认]：将译文添加到原文后
* __加在原文前__：将译文添加到原文前
* __不保留原文__：删除原文只保留译文

__【 译文颜色 】__

* __颜色值__：CSS 颜色值，如 #666666, gry, rgb(80, 80, 80)

你可以通过点击【选择】按钮从调色盘选取颜色，也可以手动输入颜色值，颜色值可参考 MDN 有关“[颜色值](https://developer.mozilla.org/en-US/docs/Web/CSS/color_value)”的文档。如果留空则不使用自定义颜色。

__【 忽略翻译 】__

* __关键词__：排除带关键词的内容（一行一条关键词）
* __关键词（区分大小写）__：排除带关键词的内容，字母区分大小写（一行一条关键词）
* __正则表达式__：排除匹配正则表达式规则的内容（一行一条规则）

正则表达式语法可参考 Python 官方文档中的“[正则表达式语法](https://docs.python.org/3/library/re.html#regular-expression-syntax)”。

### 设置

__【 输出路径 】__

* __书库__ [默认]：电子书翻译完成后会放入 Calibre 书库中
* __路径__：电子书翻译完成后会存放到指定目录中

__【 翻译引擎 】__

* __Google__ [默认]：免费的翻译引擎
* __ChatGPT__：需要 API 密钥
* __DeepL__：需要 API 密钥
* __DeepL(Pro)__：需要 API 密钥

注意，除了 Google 不需要 API 密钥外，其他翻译引擎都需要你注册相应账户（可能需要付费）获取 API 密钥才能使用。另外，由于插件在开发时缺少 DeepL 的 API 密钥，根据其官网提供的响应信息样例，程序可以正常运行，实际运行情况未知。

如果选择使用需要付费的翻译引擎，建议前往相应的官方文档查看计费规则。比如，ChatGPT，可以使用其官方提供的工具 [Tokenizer](https://platform.openai.com/tokenizer) 估算要翻译字数大约会消耗多少 token 以便预估费用。

__【 ChatGPT提示词 】__

* __自动探测来源语言时的提示词__：自定义当来源语言为“自动探测”时的翻译提示词
* __指定来源语言时的提示词__：自定义当来源语言为指定语言时的翻译提示词

__【 网络代理 】__

* __开启__ [默认不勾选]：开启网络代理
* __主机__：支持 IP 和域名
* __端口__：范围 0-65536
* __测试__：测试代理的连通性

__【 缓存 】__

* __开启__ [默认勾选]：开启翻译内容的缓存功能
* __清除__：删除所有缓存

开启缓存功能可以避免请求失败或网络中断后对已翻译过的内容进行重新翻译。另外，你还可以在这里看到缓存对磁盘空间的占用量，点击【清除】按钮可删除所有缓存。注意，如果当前有正在进行的翻译任务，则清除按钮不可用。

__【 请求 】__

* __重试次数__ [默认 3 次]：当请求翻译引擎失败后要重试的次数
* __最大间隔__ [默认 5 秒]：向翻译引擎发送请求的最大时间间隔

插件对翻译引擎的每次请求最长可持续 300 秒，超时后会按照指定的次数进行重试，每次重试的等待时间会逐次加长。请求的时间间隔为 1 到指定最大间隔之间的随机数。

对于 Google 翻译这种目前可以免费使用的接口，建议酌情加长时间间隔（建议 5 秒以上），以免被 Google 翻译视为滥用，从而导致翻译中断或拒绝服务。付费翻译引擎则可以设为 1。

__【 日志 】__

* __显示翻译__ [默认勾选]：可以在翻译任务各自的日志窗口实时查看翻译内容

---

## 许可证

[GNU General Public License v3.0](https://www.gnu.org/licenses/gpl-3.0.en.html)

---

* GitHub：[https://github.com/bookfere/Ebook-Translator-Calibre-Plugin](https://github.com/bookfere/Ebook-Translator-Calibre-Plugin)
* MobileRead: [https://www.mobileread.com/forums/showthread.php?t=353052](https://www.mobileread.com/forums/showthread.php?t=353052)
* 发布页面：[https://bookfere.com/post/1057.html](https://bookfere.com/post/1057.html)
* 赞赏页面：[https://bookfere.com/donate](https://bookfere.com/donate)
