# 電子書翻譯器（Calibre 插件）

一個可以將電子書翻譯成指定語言（原文譯文對照）的插件。

---

## 主要功能

* 支持所選翻譯引擎所支持的語言（如 Google 翻譯支持 134 種）
* 支持多種翻譯引擎，包括 Google 翻譯、ChatGPT 以及 DeepL
* 支持所有 Calibre 所支持的電子書格式（輸入格式 48 種，輸出格式 20 種）
* 支持批量翻譯電子書，每本書的翻譯過程同時進行互不影響
* 支持緩存翻譯內容，在請求失敗或網絡中斷後無需重新翻譯
* 提供大量自定義設置，如將翻譯的電子書存到 Calibre 書庫或指定位置

---

## 安裝插件

首先確保你的操作系統已經安裝了 [Calibre](https://calibre-ebook.com/)。

1. 首先在[插件發佈頁面](https://github.com/bookfere/Ebook-Translator-Calibre-Plugin/releases))下載插件文件；
2. 然後打開 Calibre 並依次點擊其菜單【首選項 → 插件 → 從文件加載插件】，彈出的對話框中選擇下載的後綴名爲 .zip 的插件文件完成安裝（請留意，首次安裝此插件時，要選擇把圖標顯示在主工具欄上）；
3. 最後關閉並重新打開 Calibre 即可正常使用。

如果安裝插件後，插件圖標未出現在 Calibre 的主工具欄上，可以依次點擊 Calibre 的菜單【首選項 → 工具與菜單】，在彈出的對話框中點擊下拉菜單並選擇“主工具欄”，然後在左欄找到並選中插件圖標，點擊中間的右箭頭按鈕【>】將其添加到右欄，最後點擊【應用】按鈕即可。

---

## 使用方法

1. 在 Calibre 書庫中選中要推送的電子書；
2. 點擊 Calibre 主工具欄上的【翻譯書籍】圖標按鈕彈出插件主界面，在這裏你可以修改“書名”（作爲保存文件時使用的文件名），分別爲每一本書選擇“輸入格式”、“輸出格式”、“來源語言”（一般情況下“自動探測”即可滿足需求）、“目標語言”（默認使用 Calibre 界面當前所用的語言）；
3. 點擊下方的【翻譯】按鈕即可開始翻譯。

插件會將每本電子書的翻譯任務推送添加到 Calibre 的任務隊列，你可以通過點擊 Calibre 右下角的【任務】查看推送詳情，雙擊任務條目可以進入日誌實時查看正在翻譯的內容。

---

## 設置說明

你可以通過“內容”和“設置”選項定製插件功能。

### 內容

__【 譯文位置 】__

* __加在原文後__ [默認]：將譯文添加到原文後
* __加在原文前__：將譯文添加到原文前
* __不保留原文__：刪除原文只保留譯文

__【 譯文顏色 】__

* __顏色值__：CSS 顏色值，如 #666666, gry, rgb(80, 80, 80)

你可以通過點擊【選擇】按鈕從調色盤選取顏色，也可以手動輸入顏色值，顏色值可參考 MDN 有關“[顏色值](https://developer.mozilla.org/en-US/docs/Web/CSS/color_value)”的文檔。如果留空則不使用自定義顏色。

__【 忽略翻譯 】__

* __關鍵詞__：排除帶關鍵詞的內容（一行一條關鍵詞）
* __關鍵詞（區分大小寫）__：排除帶關鍵詞的內容，字母區分大小寫（一行一條關鍵詞）
* __正則表達式__：排除匹配正則表達式規則的內容（一行一條規則）

正則表達式語法可參考 Python 官方文檔中的“[正則表達式語法](https://docs.python.org/3/library/re.html#regular-expression-syntax)”。

### 設置

__【 輸出路徑 】__

* __書庫__ [默認]：電子書翻譯完成後會放入 Calibre 書庫中
* __路徑__：電子書翻譯完成後會存放到指定目錄中

__【 翻譯引擎 】__

* __Google__ [默認]：免費的翻譯引擎
* __ChatGPT__：需要 API 密鑰
* __DeepL__：需要 API 密鑰
* __DeepL(Pro)__：需要 API 密鑰
* __Youdao__: 需要 APP key 和 secret
* __Baidu__: 需要 APP id 和 key

注意，除了 Google 不需要 API 密鑰外，其他翻譯引擎都需要你註冊相應賬戶（可能需要付費）獲取 API 密鑰才能使用。另外，由於插件在開發時缺少 DeepL 的 API 密鑰，根據其官網提供的響應信息樣例，程序可以正常運行，實際運行情況未知。

如果選擇使用需要付費的翻譯引擎，建議前往相應的官方文檔查看計費規則。比如，ChatGPT，可以使用其官方提供的工具 [Tokenizer](https://platform.openai.com/tokenizer) 估算要翻譯字數大約會消耗多少 token 以便預估費用。

__【 ChatGPT提示詞 】__

* __自動探測來源語言時的提示詞__：自定義當來源語言爲“自動探測”時的翻譯提示詞
* __指定來源語言時的提示詞__：自定義當來源語言爲指定語言時的翻譯提示詞

__【 網絡代理 】__

* __開啓__ [默認不勾選]：開啓網絡代理
* __主機__：支持 IP 和域名
* __端口__：範圍 0-65536
* __測試__：測試代理的連通性

__【 緩存 】__

* __開啓__ [默認勾選]：開啓翻譯內容的緩存功能
* __清除__：刪除所有緩存

開啓緩存功能可以避免請求失敗或網絡中斷後對已翻譯過的內容進行重新翻譯。另外，你還可以在這裏看到緩存對磁盤空間的佔用量，點擊【清除】按鈕可刪除所有緩存。注意，如果當前有正在進行的翻譯任務，則清除按鈕不可用。

__【 請求 】__

* __重試次數__ [默認 3 次]：當請求翻譯引擎失敗後要重試的次數
* __最大間隔__ [默認 5 秒]：向翻譯引擎發送請求的最大時間間隔

插件對翻譯引擎的每次請求最長可持續 300 秒，超時後會按照指定的次數進行重試，每次重試的等待時間會逐次加長。請求的時間間隔爲 1 到指定最大間隔之間的隨機數。

對於 Google 翻譯這種目前可以免費使用的接口，建議酌情加長時間間隔（建議 5 秒以上），以免被 Google 翻譯視爲濫用，從而導致翻譯中斷或拒絕服務。付費翻譯引擎則可以設爲 1。

__【 日誌 】__

* __顯示翻譯__ [默認勾選]：可以在翻譯任務各自的日誌窗口實時查看翻譯內容

---

## 許可證

[GNU General Public License v3.0](https://www.gnu.org/licenses/gpl-3.0.en.html)

---

* GitHub：[https://github.com/bookfere/Ebook-Translator-Calibre-Plugin](https://github.com/bookfere/Ebook-Translator-Calibre-Plugin)
* MobileRead: [https://www.mobileread.com/forums/showthread.php?t=353052](https://www.mobileread.com/forums/showthread.php?t=353052)
* 發佈頁面：[https://bookfere.com/post/1057.html](https://bookfere.com/post/1057.html)
* 讚賞頁面：[https://www.paypal.com/paypalme/bookfere](https://www.paypal.com/paypalme/bookfere)
